<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" >
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:href="@{css/publicMatching.css}" rel="stylesheet" type="text/css"/>
</head>
<body>
	<div class="navbar" th:replace="~{common/navbar.html :: navbar}"></div>
	<main class="inner-content d-flex justify-content-center">
		<form class="w-50" action="publicMatching2.mc" method="post">		
			<div class="publicMatching-wrap text-center">
				<div class="w-100">
					<a href="home.do"><img class="logo-image mb-4" src="image/logo-removebg.png" width="300"></a>
					<h1 class="h3 mb-2 fw-bold text-center">공개 매칭 신청</h1>
					<div class="page-num mb-3">
						<img src="image/icon/1page-color-deepGreen.png"></img>
						<img src="image/icon/2page.png"></img>
					</div>
					<div class="mb-5">
						<p><em>*</em> 아래 정보는 기존에 입력한 공개 매칭 설정 정보들입니다.<br>
						   <em>*</em> 아래 정보를 바탕으로 공개 매칭방이 생성됩니다. 정확하게 입력해주세요
						</p>
					</div>
				</div>
				<!-- <div class="text-start mb-3 text-center"><span class="mb-5">< <strong>김기룡</strong> 회원님의 정보 ></span></div> -->
				<div class="icon-wrap d-flex justify-content-center">
					<input type="hidden" name="service" id="selectedLocation">
					<div class="icon-container d-flex flex-column" data-value="home" onclick="selectIcon(this)">
						    <img width="50" height="50" src="https://img.icons8.com/ios/50/home--v1.png" alt="home--v1"/>
						    <p class="fs-3">집</p>
					</div>
					<div class="icon-container" data-value="hospital" onclick="selectIcon(this)">
	  						<img width="64" height="64" src="https://img.icons8.com/pastel-glyph/64/hospital--v3.png" alt="hospital--v3"/>
					   	 	<p class="fs-3">병,의원</p>
					</div>
				</div>
				
				<div id="homeInput" class="input-field hidden">
				    <div class="address-row w-50 mb-2">
				        <label for="addressCode">우편번호</label>
				        <input type="text" id="addressCode" placeholder="우편번호"  th:value="${#strings.arraySplit(patient.ptAddress, '//')[0]}" class="adressCode">
				    </div>
				    <div class="address-row w-75 mb-2">
				        <label for="address">주소</label>
				        <input type="text" id="address" placeholder="주소"  th:value="${#strings.arraySplit(patient.ptAddress, '//')[1]}">
				    </div>
				    <div class="address-row w-75 mb-2">
				        <label for="detailAddress">상세주소</label>
				        <input type="text" id="detailAddress" placeholder="상세주소" th:value="${#strings.arraySplit(patient.ptAddress, '//')[2]}">
				    </div>
				    <input type="hidden" id=ptAddress>
				</div>
				
				<div id="hospitalInput" class="input-field hidden">
				   <div class="address-row w-50 mb-2">
				        <label for="addressCode">우편번호</label>
				        <input type="text" id="addressCode" placeholder="우편번호"  th:value="${#strings.arraySplit(patient.ptAddress, '//')[0]}" class="adressCode">
				    </div>
				    <div class="address-row w-75 mb-2">
				        <label for="address">주소</label>
				        <input type="text" id="address" placeholder="주소"  th:value="${#strings.arraySplit(patient.ptAddress, '//')[1]}">
				    </div>
				    <div class="address-row w-75 mb-2">
				        <label for="detailAddress">상세주소</label>
				        <input type="text" id="detailAddress" placeholder="상세주소"  th:value="${#strings.arraySplit(patient.ptAddress, '//')[2]}">
				    </div>
				    <input type="hidden" id=ptAddress>
				</div>
				<div class="basic-info-wrap d-flex justify-content-center">
					<div class="basic-info">
							<div class="form-floating mb-3">
								<input type="text" class="form-control" id="floatingInput" name="ptName" th:value="${patient.ptName}">
								<label for="floatingInput">이름</label>
							</div>
							<div class="form-group mb-3">
	                            <div class="radio-group">
	                                <input type="radio" id="male" name="ptGender" value="M" class="btn-check" th:checked="${patient.ptGender == 'M'}">
	                                <label for="male" class="btn-radio">남성</label>
	                                
	                                <input type="radio" id="female" name="ptGender" value="F" class="btn-check" th:checked="${patient.ptGender == 'F'}">
	                                <label for="female" class="btn-radio">여성</label>
	                            </div>
                        	</div>
							<div class="form-floating d-flex mb-3">
								<input type="text" class="form-control" id="floatingPassword" name="ptAge" th:value="${patient.ptAge}">
								<label for="floatingPassword">생년월일</label>
							</div>
							<div class="form-floating d-flex mb-3">
								<input type="text" class="form-control" id="floatingPassword" name="ptHeight" th:value="${patient.ptHeight}">
								<label for="floatingPassword">키</label><p class="mt-2">cm</p>
							</div>
							<div class="form-floating d-flex mb-3">
								<input type="text" class="form-control" id="floatingPassword" name="ptWeight" th:value="${patient.ptWeight}">
								<label for="floatingPassword">몸무게</label><p class="mt-2">kg</p>
							</div>
					</div>
				</div>			
				
               	<div class="sign-btn mt-5 d-flex justify-content-center">
					<button type="submit" class="apply-btn me-3"><span>다음</span></button>
				</div>	
			</div>	
		</form>
	</main>
	<div class="footer" th:replace="~{common/footer.html :: footer}"></div>
	<script>
		function combineAddress(inputId) {
		    const container = document.getElementById(inputId);
		    const addressCode = container.querySelector('#addressCode').value;
		    const address = container.querySelector('#address').value;
		    const detailAddress = container.querySelector('#detailAddress').value;
	
		    // 주소 조합
		    const combinedAddress = `${addressCode}//${address}//${detailAddress}`;
	
		    // hidden input에 값 설정
		    container.querySelector('#ptAddress').value = combinedAddress;
		}
		
		function handleFormSubmit(event) {
			const selectedLocation = document.getElementById('selectedLocation').value;
		    if (!selectedLocation) {
		        event.preventDefault(); // 폼 제출 중단
		        alert('위치를 선택해주세요.');
		        return;
		    }

		    // 선택된 아이콘 확인
		    const selectedIcon = document.querySelector('.icon-container.selected');
		    if (!selectedIcon) {
		        alert('주소 유형(집 또는 병원)을 선택해주세요.');
		        return;
		    }

		    const selectedType = selectedIcon.getAttribute('data-value');
		    const inputId = selectedType === 'home' ? 'homeInput' : 'hospitalInput';
			
		    // 선택된 입력 필드의 주소 조합
		    combineAddress(inputId);
		    const selectedPtAddress = document.getElementById(inputId).querySelector('#ptAddress').value;
		    let hiddenInput = document.querySelector('input[name="ptAddress"]');
		    if (!hiddenInput) {
		        hiddenInput = document.createElement('input');
		        hiddenInput.type = 'hidden';
		        hiddenInput.name = 'ptAddress';
		        event.target.appendChild(hiddenInput);
		    }
		    hiddenInput.value = selectedPtAddress;

		    // 폼 제출
		    event.target.submit();
		}

		function selectIcon(element) {
		    // 모든 아이콘에서 'selected' 클래스 제거
		    document.querySelectorAll('.icon-container').forEach(icon => {
		        icon.classList.remove('selected');
		    });
		    
		    // 클릭된 아이콘에 'selected' 클래스 추가
		    element.classList.add('selected');
		    
		    // 선택된 값 (예: 'home' 또는 'hospital')
		    const selectedValue = element.getAttribute('data-value');	
		    
		    // hidden input에 선택된 값 저장
		    document.getElementById('selectedLocation').value = selectedValue;

		    // 두 입력 필드 모두 숨김
		    document.getElementById('homeInput').classList.add('hidden');
		    document.getElementById('hospitalInput').classList.add('hidden');

		    // 선택된 입력 필드만 표시
		    if (selectedValue === 'home') {
		        document.getElementById('homeInput').classList.remove('hidden');
		    } else if (selectedValue === 'hospital') {
		        document.getElementById('hospitalInput').classList.remove('hidden');
		    }
		}

		// 폼에 이벤트 리스너 추가
		document.querySelector('form').addEventListener('submit', handleFormSubmit);
	</script>
</body>
</html>