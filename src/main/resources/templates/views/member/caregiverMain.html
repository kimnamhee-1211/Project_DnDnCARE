<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간병인 메인페이지</title>
    <link href="css/caregiverMain.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <style>
    	.fc{width:500px !important; height:500px !important; } 
    </style>
</head>
<body>
	<div th:replace="~{common/navbar :: navbar}"></div>
	
	<br/>
	
	<div id="upperContents">
		<div><!-- 왼쪽 공백 --></div>
		<div id="upperLeftContents">
			<div><!-- AI 매칭 : 가로 700, 세로 200 -->
				<table class="table mainTable table-hover">
                 <thead>
                     <tr>
                         <th colspan="5">나와 딱 맞는 일감을 찾아드려요.</th>
                         <th class="text-center">
                        	<img src="image/icon/refresh.png" id="refreshChoice" style="width:30px; height:30px;">
                        </th>
                     </tr>
                 </thead>
                 <tbody>
                     <tr class="text-center" th:if="${completeList}" th:each="l : ${completeList}">
                         <td>[[${l.ptName}]]*</td>
                         <td>[[${l.ptGender == 'M' ? '남' : '여'}]]</td>
                         <td>[[${l.ptRealAge}]]</td>
                         <td>[[${l.ptAddress}]]</td>
                         <td>[[${l.ptDisease}]]</td>
                         <td>[[${l.money}]] 원</td>
                     </tr>
                 </tbody>
            </table>
			</div>
			<div id="upperContentsBtn" class="align-middle text-center"><!-- 메뉴판 -->
				<div></div>
				<table>
                    <tr>
                        <td><button class="custom-btn btn-14">내 정보</button></td>
                        <td><button class="custom-btn btn-14">간병 정보</button></td>
                        <td><button class="custom-btn btn-14">커뮤니티</button></td>
                    </tr>
                </table>
                <div></div>
			</div>
		</div>
		<div><!-- 공백 --></div>
		<div id="calendar"></div>
		<div><!-- 오른쪽 공백 --></div>
	</div>
	
    <br/><br/>

    <!-- 아래쪽 컨텐츠-->
    <div id="underContents">
        <div><!--왼쪽 공백--></div>
        <div><!--매칭정보 : 가로 500, 세로 700-->
            <table class="table mainTable">
                <thead>
                    <tr>
                        <th colspan="5" class="align-middle">현재 개나리님과 매칭 중 입니다.</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="align-middle text-center">
                        <td class="align-middle">남성</td>
                        <td>50</td>
                        <td>서울시 종로구</td>
                        <td>다리골절</td>
                        <td rowspan="2"><button class="btn btn-success">대화신청</button></td>
                    </tr>
                    <tr class="align-middle text-center">
                        <td>24-07-24</td>
                        <td>~</td>
                        <td>24-08-15</td>
                        <td></td>
                    </tr>
                    <tr class="align-middle text-center">
                        <td colspan="4" class="align-middle">나팔꽃님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">
                        <td colspan="4" class="align-middle">다람쥐님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">
                        <td colspan="4" class="align-middle">라일락님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">마동석님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>   
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">바밤바님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">바밤바님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">바밤바님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">바밤바님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">바밤바님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                    <tr class="align-middle text-center">    
                        <td colspan="4" class="align-middle">바밤바님이 매칭을 원하고 있어요</td>
                        <td><button class="btn btn-success workInfo">정보보기</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div><!--공백 --></div>
        <div id="findWorkList" class="text-center"><!--대상검색 : 가로 700, 세로 700-->
            <br/>
            <button type="button" class="btn btn-light">지역</button>
            &nbsp;&nbsp;
            <button type="button" class="btn btn-light">성별</button>
            &nbsp;&nbsp;
            <button type="button" class="btn btn-light">연령</button>
            &nbsp;&nbsp;
            <button type="button" class="btn btn-light">질환</button>
            &nbsp;&nbsp;
            <button type="button" class="btn btn-light">중증도</button>
            &nbsp;&nbsp;
            <br/>
            <button type="button" class="btn btn-link" onclick="location.href='moreWorkInfo.me'">더 보기</button>
            <br/><br/>

            <div class="row row-cols-md-2 g-2">
                <div class="col-sm-6">
                    <div class="card h-95 w-80">
                      <div class="card-body">
                        <h6 class="card-title">
                        	<span style="background:skyblue; color:blue;">MM월 dd일 HH시</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">성별</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">나이</span>&nbsp;&nbsp;
                        	<img src="image/icon/hospital.png"/>
                       	</h6>
                        <p class="card-text">
                        	<span>병원이름</span>
                       	</p>
                        <button class="btn btn-success workInfo">정보 보기</button>
                      </div>
                    </div>
                  </div>
                <div class="col-sm-6">
                    <div class="card h-95 w-80">
                      <div class="card-body">
                        <h6 class="card-title">
                        	<span style="background:skyblue; color:blue;">MM월 dd일 HH시</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">성별</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">나이</span>&nbsp;&nbsp;
                        	<img src="image/icon/home.png"/>
                       	</h6>
                        <p class="card-text">
                        	<span>집 주소(가사돌봄임)</span>
                       	</p>
                        <button class="btn btn-success workInfo">정보 보기</button>
                      </div>
                    </div>
                </div>
                
                <div class="col-sm-6">
                    <div class="card h-95 w-80">
                      <div class="card-body">
                        <h6 class="card-title">
                        	<span style="background:skyblue; color:blue;">MM월 dd일 HH시</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">성별</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">나이</span>&nbsp;&nbsp;
                        	<img src="image/icon/users.png"/>
                       	</h6>
                        <p class="card-text">
                        	<span>병원명(공동간병버전)</span>
                       	</p>
                        <button class="btn btn-success workInfo">정보 보기</button>
                      </div>
                    </div>
                  </div>
                <div class="col-sm-6">
                    <div class="card h-95 w-80">
                      <div class="card-body">
                        <h6 class="card-title">
                        	<span style="background:skyblue; color:blue;">MM월 dd일 HH시</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">성별</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">나이</span>&nbsp;&nbsp;
                        	<img src="image/icon/hospital.png"/>
                       	</h6>
                        <p class="card-text">
                        	<span>병원명</span>
                       	</p>
                        <button class="btn btn-success workInfo">정보 보기</button>
                      </div>
                    </div>
                </div>

                <div class="col-sm-6">
                    <div class="card h-95 w-80">
                      <div class="card-body">
                        <h6 class="card-title">
                        	<span style="background:skyblue; color:blue;">MM월 dd일 HH시</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">성별</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">나이</span>&nbsp;&nbsp;
                        	<img src="image/icon/hospital.png"/>
                       	</h6>
                        <p class="card-text">
                        	<span>병원명</span>
                       	</p>
                        <button class="btn btn-success workInfo">정보 보기</button>
                      </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card h-95 w-80">
                      <div class="card-body">
                        <h6 class="card-title">
                        	<span style="background:skyblue; color:blue;">MM월 dd일 HH시</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">성별</span>&nbsp;&nbsp;
                        	<span style="background:lightgrey;">나이</span>&nbsp;&nbsp;
                        	<img src="image/icon/hospital.png"/>
                       	</h6>
                        <p class="card-text">
                        	<span>병원명</span>
                       	</p>
                        <button class="btn btn-success workInfo">정보 보기</button>
                      </div>
                    </div>
                </div>
            </div>
            
            <!-- 페이징 버튼 -->
            <div class="pt-0">
                <ul class="pagination justify-content-center mb-0">
                   	<!-- 이전버튼 -->
                   	<li class="page-item disabled">
                       	<a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                    </li>
                   	                        
                    <li class="page-item active">
                    	<a class="page-link" href="#">1</a>
                   	</li>
                   <li class="page-item">
                    	<a class="page-link" href="#">2</a>
                   	</li>
                   	<li class="page-item">
                    	<a class="page-link" href="#">3</a>
                   	</li>
                   	<li class="page-item active">
                    	<a class="page-link" href="#">4</a>
                   	</li>
                   	<li class="page-item">
                    	<a class="page-link" href="#">5</a>
                   	</li>
                   
                   	<!-- 다음 버튼 -->
                 	<li class="page-item disabled">
                 		<a class="page-link" href="#" aria-disabled="true">Next</a>
                	</li>
                </ul>
            </div>
        </div>
        <div><!--오른쪽 공백--></div>
    </div>
    
    <div id="myPresentMatching">
        <a class="navbar-brand align-middle" href="#">
            <img src="image/icon/deal.png">
            나의 매칭 현황
        </a>
    </div>
    
    <!-- 일감찾기(우측하단)의 모달박스 -->
    <div class="modal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
		   		<div class="modal-header">
		    		<div class="modal-title workInfo">
		    			<div>
			    			<span class="badge bg-danger"><img src="image/icon/time.png"/>&nbsp;HH시간 mm분 ss초 남음</span><br/>
			    			<span>혜민병원</span><br/>
			    			<span>서울특별시 광진구</span>
		    			</div>
		    			<div class="text-end align-middle">
		    				<br/>
				    		<img src="image/icon/hospital.png" aria-label="Close" style="width:60px; height:60px;">
		    			</div>
		    		</div>
		    		<!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
		   		</div>
		    	<div class="modal-body workInfo">
		    		<div>
		    			<span>환자 성별</span><br/>
		    			<span>간병 시작일</span><br/>
		    			<span>총 간병 기간</span><br/>
		    			<span>예상 일 간병비</span><br/>
		    		</div>
		    		<div class="text-end fw-bold">
		    			<span>남성</span><br/>
		    			<span>08월 01일 16시</span><br/>
		    			<span>17일</span><br/>
		    			<span>152,000원</span>
		    		</div>
		    	</div>
		    	<div class="modal-footer">
	    			<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="width:200px;">Close</button>
	    			<button type="button" class="btn btn-primary" id="detailInfo" style="width:200px;">자세히 보기</button>
		    	</div>
		  	</div>
		</div>
	</div>
    
    
    
    
    
    <th:block th:replace="~{common/footer :: footer}"></th:block>
    
    <script th:inline="javascript">
    	/*<![CDATA[*/
    	document.addEventListener('DOMContentLoaded', function() {
        	var calendarEl = document.getElementById('calendar');
        	//var request = $.ajax({
        	//	url: 'caregiverCalendarEvent.me',
        	//	data: {memberNo : /*[[${session.loginUser.memberNo}]]*/0},
        	//})
        	
        	/* request.done(function(data) {
        		var calendar = new FullCalendar.Calendar(calendarEl, {
  		          initialView: 'dayGridMonth',
  		          events : data,
  		          eventColor: '#8dd986',
  		          eventClick: function(info) {
  		        	    alert('Event: ' + info.event.title + '\n' + '금액: ' + '80,000원\n' + '장소 :' + '세브란스 병원' );
  		        	  }
  		        });
  		        calendar.render();
        	}) */
        	var calendar = new FullCalendar.Calendar(calendarEl, {
          		initialView: 'dayGridMonth'
        	});
        	calendar.render();
      	});
    	/*]]>*/
    	
    	
    	/*<![CDATA[*/
    	window.onload = () => {
    		// 자동추천 새로고침 비동기 요청 (시작)
    		const refreshChoice = document.querySelector('#refreshChoice');
    		refreshChoice.addEventListener('mouseenter', function() {
    			this.style.cursor= 'pointer';
    		})
    		
    		refreshChoice.addEventListener('click', function() {
    			if(/*[[${completeList}]]*/'arrList' != null) {
    				const tbody = this.parentElement.parentElement.parentElement.nextElementSibling;
    				
    				
    				$.ajax({
	    				url: 'refreshChoice.me',
	    				data: {memberNo : /*[[${session.loginUser.memberNo}]]*/0},
	    				success: data => { // 배열로 넘어옴
	    					// 새로 추천받은 목록으로 교체(시작)
	    					console.log(data);
	    					tbody.innerText = '';
	    					for(let d of data) {
	    						const tr = document.createElement('tr');
	    						tr.classList.add('text-center');
	    						const td0 = document.createElement('td');
	    						td0.innerText = d.ptName;
	    						const td1 = document.createElement('td');
	    						td1.innerText = d.ptGender == 'M' ? '남' : '여';
	    						const td2 = document.createElement('td');
	    						td2.innerText = d.ptRealAge;
	    						const td3 = document.createElement('td');
	    						td3.innerText = d.ptAddress;
	    						const td4 = document.createElement('td');
	    						td4.innerText = d.ptDisease;
	    						const td5 = document.createElement('td');
	    						td5.innerText = d.money + '원';
	    						
	    						tbody.appendChild(tr);
	    						tr.appendChild(td0);
	    						tr.appendChild(td1);
	    						tr.appendChild(td2);
	    						tr.appendChild(td3);
	    						tr.appendChild(td4);
	    						tr.appendChild(td5);
	    						// 새로 추천받은 목록으로 교체(끝)
	    					}
	    					alert('새고운 추천목록으로 갱신되었습니다.');
	    				},
	    				error: data => {
	    					console.log('에러')
	    				}
	    			})
    			} else {
    				alert('추천 후보가 존재하지 않습니다.');
    			}
    		})
    		// 자동추천 새로고침 비동기 요청 (끝)
    		
    		// 일감 목록에서 모달창으로 정보 보기(시작)
    		const infoBtnList = document.querySelectorAll('.workInfo');
    		for(let btn of infoBtnList) {
    			btn.addEventListener('click', () => {
    				$('.modal').modal('show');
    			})
    		}
    		// 일감 목록에서 모달창으로 정보 보기(끝)
    		
    		// 일감 목록 모달창에서 자세한 정보 보기(시작)
    		const detailInfo = document.querySelector('#detailInfo');
    		detailInfo.addEventListener('click', () => {
    			// location.href = '';
    			
    			
    		})
    		// 일감 목록 모달창에서 자세한 정보 보기(끝)
    		
    		
    		
    		
    		
    		
    		
    	}
    	/*]]>*/
    	
    	
    	
    </script>    
</body>
</html>